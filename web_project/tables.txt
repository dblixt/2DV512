CREATE TABLE Users
(
  id INT NOT NULL GENERATED ALWAYS AS IDENTITY,
  email VARCHAR(128) NOT NULL UNIQUE,
  password BLOB(512) NOT NULL,
  salt BLOB(256) NOT NULL,
  reset_token CHAR(32),
  PRIMARY KEY(id)
);

CREATE TABLE Profiles
(
  user_id INT NOT NULL,
  name VARCHAR(128) NOT NULL,
  gender VARCHAR(10), 
  description VARCHAR(1024),
  pos_lng DOUBLE,
  pos_lat DOUBLE, 
  feed_radius INT NOT NULL DEFAULT 10,
  img VARCHAR(64),
  CONSTRAINT fk_user_id FOREIGN KEY(user_id) REFERENCES Users(id) ON DELETE RESTRICT,
  PRIMARY KEY(user_id)
);

CREATE TABLE Dogs 
(
  id INT NOT NULL GENERATED ALWAYS AS IDENTITY,
  user_id INT NOT NULL,
  name VARCHAR(128) NOT NULL,
  breed VARCHAR(128) NOT NULL,
  age INT NOT NULL,
  gender VARCHAR(10), 
  img VARCHAR(64),
  CONSTRAINT fk_user_id FOREIGN KEY(user_id) REFERENCES Users(id) ON DELETE RESTRICT,
  PRIMARY KEY(id)
);

CREATE TABLE Events
(
  id INT NOT NULL GENERATED ALWAYS AS IDENTITY,
  user_id INT NOT NULL,
  utc_date BIGINT NOT NULL,
  title VARCHAR(128),
  description VARCHAR(1024),
  pos_lng DOUBLE,
  pos_lat DOUBLE, 
  utc_date_modified BIGINT NOT NULL,
  canceled int default 0,
  CONSTRAINT fk_user_id FOREIGN KEY(user_id) REFERENCES Users(id) ON DELETE RESTRICT,
  PRIMARY KEY(id)
);

CREATE TABLE Comments
(
  id INT NOT NULL GENERATED ALWAYS AS IDENTITY,
  user_id INT NOT NULL,
  event_id INT NOT NULL,
  date BIGINT NOT NULL,
  comment VARCHAR(512),
  CONSTRAINT fk_user_id FOREIGN KEY(user_id) REFERENCES Users(id) ON DELETE RESTRICT,
  CONSTRAINT fk_event_id FOREIGN KEY(event_id) REFERENCES Events(id) ON DELETE RESTRICT,
  PRIMARY KEY(id)
);

CREATE TABLE EventJoins
(
  user_id INT NOT NULL,
  event_id INT NOT NULL,
  utc_date BIGINT NOT NULL,
  approved INT DEFAULT 0,
  CONSTRAINT fk_event_id FOREIGN KEY(event_id) REFERENCES Events(id) ON DELETE RESTRICT,
  CONSTRAINT fk_user_id FOREIGN KEY(user_id) REFERENCES Users(id) ON DELETE RESTRICT
);

CREATE TABLE Notifications
(
	id INT NOT NULL GENERATED ALWAYS AS IDENTITY,
	type INT NOT NULL,
	target_user_id INT NOT NULL,
	source_user_id INT NOT NULL,
	event_id INT NOT NULL,
	utc_date BIGINT NOT NULL
);

