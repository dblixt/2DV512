<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html">


<ui:composition template="/template/layoutUser.xhtml">
	<f:metadata>
		<f:viewParam name="id" value="#{editEventController.editEventId}" />
		<f:event type="preRenderView"
			listener="#{editEventController.loadEvent}" />
	</f:metadata>

	<ui:define name="head">
		<h:outputStylesheet name="createevent.css" library="css" />
		<h:outputStylesheet name="calenderview.css" library="css" />
		<h:outputStylesheet name="map.css" library="css" />
		<h:outputScript name="map.js" library="js" />
		<h:outputScript name="prototype.js" library="js" />
		<h:outputScript name="calenderview.js" library="js" />
		<h:outputScript>
		var myCal;
		var hour = 0;
		var minute = 0;
		var unixTime;
		function setupCalendars() {
        		// Embedded Calendar
       		myCal = Calendar.setup(
         	{
              parentElement: 'embeddedCalendar'
          	}
        	)
        	
        	var prevDate = document.getElementById('unixtime').value;
        	console.log('prevDate',prevDate);
        	if(prevDate != null){
        	prevDate = prevDate * 1000;
        	var newDate = new Date();
        	newDate.setTime(prevDate);
        	console.log('newdate', newDate);
        	myCal.setDate(newDate);
        	var hourInput = document.getElementById('hourinput');
        	var hourInput = document.getElementById('minuteinput');
        	hourinput.value = newDate.getUTCHours();
        	minuteinput.value = newDate.getUTCMinutes();
        	
        	}
      	}      
		
		function calculateUnixTime() {
			
			var tempDate = new Date(myCal.date);
			var year = tempDate.getFullYear();
			var day = tempDate.getDate();
			var month = tempDate.getMonth() + 1;
			var newDate = new Date(year+'-'+month+'-'+day);	
			unixTime = newDate.getTime() / 1000 +hour +minute;
			
			console.log(unixTime);
			
			var unixinput = document.getElementById('unixtime');
			unixinput.value = unixTime;
			
		}
		
		function onHourChanged(value) {
			hour = parseInt(value) * 3600
			calculateUnixTime();
		}
		function onMinuteChanged(value) {
	 		minute = parseInt(value) * 60;
	 		calculateUnixTime();
		}
		
      

      Event.observe(window, 'load', function() { setupCalendars() })		
		</h:outputScript>
		<h:outputScript>
			setLocation(0,0);	
			setAllowEdit(true);
		</h:outputScript>
		<script
			src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDqA3iH8WgQpzZVcfSh_cqy1ZJL2GKj8QY&amp;signed_in=true&amp;callback=initMap&amp;libraries=places"
			async="async" defer="defer">
			
		</script>


	</ui:define>

	<ui:define name="content">

		<div class="content-block">
			<h:form id="createevent" prependId="false">
				<h3>
					<h:outputText
						value="#{editDogController.id != -1 ? 'Edit Event' : 'Create Event'}" />
				</h3>
				<br />
				<br />
				<label>Title:</label>
				<br />
				<h:inputText value="#{editEventController.event.title}"
					required="true"></h:inputText>
				<br />
				<br />
				<label>Description:</label>
				<br />
				<h:inputTextarea rows="4" cols="40"
					value="#{editEventController.event.description}"></h:inputTextarea>

				<div class="calendarbox">
					<div id="embeddedCalendar" class="calendar"></div>

					<div class="time">
						<br /> <span class="hour"> <label>Hour</label>
						</span> <span class="minute"> <label>Minutes</label>
						</span> <br /> <span class="hour"> <h:inputText id="hourinput"
								onchange="onHourChanged(this.value)" required="true"></h:inputText>

						</span> <span class="minute"> <h:inputText id="minuteinput"
								onchange="onMinuteChanged(this.value)" required="true"></h:inputText>
						</span>
						<h:inputHidden id="unixtime"
							value="#{editEventController.event.date}"></h:inputHidden>
					</div>
				</div>

				<div class="clear"></div>

				<div class="center">
					<label>Select location for event</label> <input id="pac-input"
						class="controls" type="text" placeholder="Search"></input>
					<div id="map"></div>
					<h:inputHidden id="lat"
						value="#{editEventController.event.latitude}" />
					<h:inputHidden id="lng"
						value="#{editEventController.event.longitude}" />
					<h:commandButton value="Create"
						action="#{editEventController.createEvent}"></h:commandButton>
					<br />
					<h:commandButton value="Cancel" action="feed"></h:commandButton>
				</div>

			</h:form>
		</div>
	</ui:define>
</ui:composition>
</html>
