<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough">


<ui:composition template="/template/layoutUser.xhtml">
	<f:metadata>
		<f:viewParam name="id" value="#{eventViewController.id}" />
		<f:event type="preRenderView"
			listener="#{eventViewController.loadData}" />

	</f:metadata>

	<ui:define name="head">
		<title>Internet of Dogs - Event</title>
		<h:outputStylesheet name="entry.css" library="css" />
		<h:outputScript name="map.js" library="js" />
		<h:outputStylesheet name="map.css" library="css" />

		<h:outputScript>
			
			setLocation(#{eventViewController.event.latitude}, #{eventViewController.event.longitude});
			setAllowEdit(false);	
			setAllowControl(false);
		</h:outputScript>

		<script
			src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDqA3iH8WgQpzZVcfSh_cqy1ZJL2GKj8QY&amp;signed_in=false&amp;callback=initMap&amp;libraries=places&amp;style=feature:all|element:labels|visibility:off"
			async="async" defer="defer">
			
		</script>


	</ui:define>



	<ui:define name="content">

		<h:form id="comment" name="comment">
			<div class="content-block">

				<h:graphicImage class="event-creator-img"
					value="/img/profile/#{eventViewController.profile.image}" />
				<div class="event-content">
					<h3 style="margin-top: 6px">#{eventViewController.event.title}</h3>
					<p class="event-creator">#{eventViewController.profile.name}</p>


					<div style="display: inline-block; margin-top: 12px;">
	
							
					<i class="material-icons" style="display: inline-block; font-size: 14px; vertical-align: middle; color: #323232;">near_me</i>
						<p style="display: inline; font-weight: bold; font-size: 14px; vertical-align: middle;">
							<h:outputText value="#{eventViewController.event.distance}">
								<f:convertNumber maxFractionDigits="1"/>
							</h:outputText> km away						 
						</p>
							
					</div>

					<div style="display: inline-block; margin-left: 12px;">
						<i class="material-icons"
							style="display: inline-block; font-size: 15px; vertical-align: middle; color: #323232;">access_time</i>
						<p
							style="display: inline; font-weight: bold; font-size: 14px; vertical-align: middle;">

							<h:outputText value="#{eventViewController.event.date * 1000}"
								class="date">
								<f:convertDateTime pattern="YYYY-MM-dd HH:mm:ss" />
							</h:outputText>

						</p>
					</div>

					<p class="vspace">#{eventViewController.event.description}</p>
					<p style="margin-top: 20px;" />

					<div>
						<ui:repeat var="d" value="#{eventViewController.dogs}">
							<h:graphicImage class="event-attendant-dog-img"
								value="/img/dog/#{d.image}" />
						</ui:repeat>
					</div>




					<h4>Attendants</h4>
					<ul class="event-attendant-list">

						<ui:repeat var="p" value="#{eventViewController.profiles}">
							<li><h:link class="event-attendant" outcome="profile">
									<h:graphicImage value="/img/profile/#{p.image}" />
									<span>#{p.name}</span>
									<f:param name="id" value="#{p.userId}" />
								</h:link></li>
						</ui:repeat>


					</ul>



					<p style="margin-top: 20px;" />


					<h4>Location</h4>
					<div id="map"></div>




					<h:commandLink class="icon-link"
						style="display: inline-block; margin-left: 5px;"
						action="#{eventViewController.joinEvent()}"
						rendered="#{eventViewController.event.joinStatus == 0 and !eventViewController.isOwnEvent()}">
						<f:ajax execute="@form" render="@form" />
						<i class="material-icons" style="font-size: 24px;">done</i>
						<span>Join</span>
					</h:commandLink>


					<ui:fragment
						rendered="#{eventViewController.event.joinStatus == 1}">
						<div class="icon-link"
							style="display: inline-block; margin-left: 5px; background: none;">
							<i class="material-icons">hourglass_empty</i><span>Join
								Requested</span>
						</div>
					</ui:fragment>


					<h:commandLink class="icon-link"
						style="display: inline-block; margin-left: 5px;"
						action="#{eventViewController.leaveEvent()}"
						rendered="#{eventViewController.event.joinStatus == 2}">

						<f:ajax execute="@form" render="@form" />
						<i class="material-icons" style="font-size: 24px;">clear</i>


						<span>Leave</span>
					</h:commandLink>




					<h:link class="icon-link"
						style="display: inline-block; margin-left: 5px;"
						outcome="editevent" rendered="#{eventViewController.isOwnEvent()}">
						<f:param name="id" value="#{e.id}" />
						<i class="material-icons">mode_edit</i>
						<span>Edit</span>
					</h:link>




				</div>
				<div class="clear" />



			</div>

			<ui:fragment
				rendered="#{eventViewController.event.joinStatus == 2 or eventViewController.isOwnEvent() }">

				<div class="content-block">

					<h2>Comments</h2>
					<h:panelGroup id="comment">
						<ul class="comment-list">
							<ui:repeat var="comment" value="#{eventViewController.comments}">

								<li><h:graphicImage class="comment-img"
										value="/img/profile/#{comment.profile.image}" />

									<div class="comment-content">

										<h:link outcome="profile" value="#{comment.profile.name}">
											<f:param name="id" value="#{comment.userId}" />
										</h:link>

										<div style="display: block;">

											<i class="material-icons"
												style="display: inline-block; font-size: 15px; vertical-align: middle; color: #323232;">access_time</i>
											<p
												style="display: inline; font-size: 13px; vertical-align: middle;">

												<h:outputText value="#{comment.date}" class="date">
													<f:convertDateTime pattern="YYYY-MM-dd HH:mm:ss" />
												</h:outputText>

											</p>

											<p style="padding-top: 8px;">#{comment.comment}</p>

										</div>
									</div>
									<div class="clear" /></li>
							</ui:repeat>
						</ul>
					</h:panelGroup>


					<h:inputTextarea class="comment-input" rows="7"
						value="#{eventViewController.comment.comment}" />
					<br />

					<h:commandLink class="icon-link action-button"
						style="display: inline-block; margin-left: 5px;"
						action="#{eventViewController.saveData}">

						<i class="material-icons" style="font-size: 24px;">done</i>
						<span>Post</span>

						<f:ajax execute="@form" render="@form" resetValues="true" />
					</h:commandLink>

				</div>

			</ui:fragment>

		</h:form>



	</ui:define>

</ui:composition>
</html>